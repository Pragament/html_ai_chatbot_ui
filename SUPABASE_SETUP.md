# Supabase Setup Guide

## Step 1: Create Supabase Project

1. Go to [supabase.com](https://supabase.com)
2. Sign in or create account
3. Click "New Project"
4. Fill in:
   - **Name**: e.g., "Educational Chatbot"
   - **Database Password**: (save this!)
   - **Region**: Choose closest to you
5. Click "Create new project"
6. Wait 2-3 minutes for setup

## Step 2: Run SQL Schema

1. In your Supabase project, click **SQL Editor** (left sidebar)
2. Click **New Query**
3. Copy the entire content from `SUPABASE_SCHEMA.sql`
4. Paste into the SQL editor
5. Click **Run** (or press Ctrl+Enter)
6. You should see: "Success. No rows returned"

## Step 3: Verify Tables Created

1. Click **Table Editor** (left sidebar)
2. You should see two tables:
   - `students` - Stores student information
   - `activities` - Stores chat history

## Step 4: Get API Credentials

1. Click **Settings** (gear icon, left sidebar)
2. Click **API** in settings menu
3. Copy these values:
   - **Project URL**: `https://xxx.supabase.co`
   - **anon public key**: `eyJhbGc...` (long string)

## Step 5: Create Configuration in Teacher Dashboard

1. Go to teacher dashboard: `http://localhost:8080`
2. Sign in with Google
3. Click "+ Create New Record"
4. Fill in:
   - **Record Name**: e.g., "Class 10A - Math"
   - **Configuration JSON**:
     ```json
     {
       "url": "https://your-project.supabase.co",
       "anonKey": "your-anon-key-here"
     }
     ```
   - **Access Type**: Choose (No PIN / Fixed PIN / OTP)
   - **PIN**: (if required)
5. Complete CAPTCHA
6. Copy the UUID shown
7. Share UUID + PIN with students

## Step 6: Test Student Login

1. Open chatbot: `html_ai_chatbot_ui/index.html`
2. Click "Login (Optional)"
3. Enter UUID from teacher
4. Enter PIN (if required)
5. Should see "✓ Logged In"
6. Send a test message
7. Check Supabase Table Editor → `activities` table
8. Your chat should be saved!

## Troubleshooting

### "401 Unauthorized" or "Connection test failed"
**This means the Supabase tables don't exist yet!**

**Fix:**
1. Go to your Supabase project
2. Click **SQL Editor** (left sidebar)
3. Click **New Query**
4. Copy ALL content from `SUPABASE_SCHEMA.sql`
5. Paste and click **Run**
6. Refresh your chatbot page
7. Should now work!

### "Failed to fetch" error
- Make sure Express server is running: `npm start` in `html_intranet_nameserver`
- Check CORS is configured for your port

### "Permission denied" in Supabase
- Make sure you ran the SQL schema (Step 2)
- Check RLS policies are created (they allow all operations)

### Activities not saving
- Open browser console (F12)
- Look for errors
- Check if `supabaseClient.isReady()` returns true
- Verify Supabase credentials are correct

### Table doesn't exist
- Re-run the SQL schema from `SUPABASE_SCHEMA.sql`
- Make sure you're in the correct project

## Schema Overview

### students table
- `id`: UUID (auto-generated)
- `student_id`: Unique identifier (generated by app)
- `name`: Student name (optional)
- `email`: Student email (optional)
- `created_at`: When student first registered
- `last_active`: Last activity timestamp

### activities table
- `id`: UUID (auto-generated)
- `student_id`: Links to student
- `request`: Student's question/prompt
- `response`: AI assistant's response
- `is_bookmarked`: Whether student bookmarked this
- `created_at`: When activity was created
- `updated_at`: When activity was last modified

## Security Notes

- Current setup allows anonymous access (no authentication required)
- All students can read/write their own data
- RLS policies can be tightened if needed
- Consider adding authentication for production use

## Next Steps

- Students can now login and their chat history is automatically saved
- Teachers can create multiple configurations for different classes
- Each configuration can have different Supabase projects
- Students' data is isolated per Supabase project
